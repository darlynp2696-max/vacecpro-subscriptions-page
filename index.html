<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>VacEcPro – Suscripciones</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="description"
        content="Suscríbete a VacEcPro y obtén acceso completo a las funciones profesionales de gestión de esquemas de vacunación." />

  <style>
    :root {
      --color-bg: #0f172a;
      --color-card: #ffffff;
      --color-primary: #2563eb;
      --color-primary-soft: #dbeafe;
      --color-text-main: #111827;
      --color-text-muted: #6b7280;
      --radius-lg: 16px;
      --radius-md: 12px;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.15);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1d4ed8 0, #020617 48%, #020617 100%);
      color: var(--color-text-main);
    }

    .layout {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 18px 24px;
      max-width: 1120px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: #e5e7eb;
    }

    header .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      font-size: 0.9rem;
    }

    header .brand-badge {
      width: 30px;
      height: 30px;
      border-radius: 9px;
      background: linear-gradient(135deg, #38bdf8, #22c55e);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      color: #0f172a;
      font-weight: 700;
    }

    header .env {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.7rem;
      border: 1px solid rgba(148, 163, 184, 0.7);
      text-transform: uppercase;
    }

    main {
      flex: 1;
      padding: 24px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .container {
      width: 100%;
      max-width: 1120px;
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
      gap: 28px;
      align-items: stretch;
    }

    @media (max-width: 900px) {
      .container {
        grid-template-columns: minmax(0, 1fr);
      }
      main {
        padding: 20px 16px 32px;
      }
      header {
        padding-inline: 16px;
      }
    }

    .hero {
      color: #f9fafb;
      padding-right: 10px;
    }

    .hero-eyebrow {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 14px;
    }

    .hero-eyebrow span {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.2);
    }

    .hero-title {
      font-size: clamp(2.1rem, 3vw, 2.6rem);
      line-height: 1.1;
      margin: 0 0 12px;
    }

    .hero-title strong { color: #bfdbfe; }

    .hero-subtitle {
      margin: 0 0 18px;
      font-size: 0.98rem;
      line-height: 1.6;
      color: #cbd5f5;
    }

    .hero-list {
      list-style: none;
      padding: 0;
      margin: 0 0 26px;
      display: grid;
      gap: 10px;
    }

    .hero-list li {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      font-size: 0.93rem;
      color: #e5e7eb;
    }

    .hero-list li::before {
      content: "✔";
      flex-shrink: 0;
      margin-top: 1px;
      font-size: 0.8rem;
      color: #22c55e;
    }

    .hero-footnote {
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .pricing-card {
      background: var(--color-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      padding: 24px 22px 26px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .pricing-header {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      margin-bottom: 4px;
    }

    .pricing-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--color-text-main);
    }

    .pricing-badge {
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      background: var(--color-primary-soft);
      color: #1d4ed8;
      font-weight: 600;
    }

    .pricing-description {
      font-size: 0.9rem;
      color: var(--color-text-muted);
      margin: 0;
    }

    /* Datos de usuario (correo) */
    .user-info {
      margin-top: 10px;
      margin-bottom: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.85rem;
    }

    .user-info label {
      color: var(--color-text-muted);
    }

    .user-info input {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 0.85rem;
      outline: none;
    }

    .user-info input:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 1px var(--color-primary-soft);
    }

    .tier-toggle {
      margin-top: 10px;
      margin-bottom: 10px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      background: #f3f4f6;
      border-radius: 999px;
      padding: 3px;
      gap: 3px;
    }

    .tier-toggle button {
      border-radius: 999px;
      border: none;
      padding: 7px 10px;
      font-size: 0.78rem;
      font-weight: 500;
      background: transparent;
      color: #4b5563;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background 0.17s, color 0.17s, transform 0.08s;
    }

    .tier-toggle button span {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .tier-toggle button.active {
      background: #ffffff;
      color: #111827;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    .tier-toggle button:active { transform: scale(0.97); }

    .price-row {
      display: flex;
      align-items: baseline;
      gap: 8px;
      margin: 6px 0 2px;
    }

    .price-main {
      font-size: 1.9rem;
      font-weight: 700;
      color: var(--color-text-main);
    }

    .price-period {
      font-size: 0.86rem;
      color: var(--color-text-muted);
    }

    .price-note {
      font-size: 0.8rem;
      color: var(--color-text-muted);
    }

    .plan-details {
      margin: 8px 0 10px;
      font-size: 0.86rem;
      color: var(--color-text-muted);
    }

    .plan-details strong { color: var(--color-text-main); }

    .paypal-section { margin-top: 6px; }

    .paypal-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: #6b7280;
      margin-bottom: 6px;
    }

    .paypal-container { max-width: 480px; }

    .alert {
      margin-top: 10px;
      border-radius: var(--radius-md);
      padding: 8px 10px;
      font-size: 0.8rem;
      display: flex;
      gap: 8px;
      align-items: flex-start;
    }

    .alert-success {
      background: #ecfdf5;
      border: 1px solid #bbf7d0;
      color: #166534;
    }

    .alert-error {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #b91c1c;
    }

    .alert-icon {
      font-size: 1rem;
      margin-top: 1px;
    }

    /* ADVERTENCIA LEGAL */
    .legal-warning {
      margin-top: 16px;
      padding: 10px 11px;
      border-radius: var(--radius-md);
      border: 1px dashed #f97316;
      background: #fffbeb;
      font-size: 0.78rem;
      color: #92400e;
      line-height: 1.5;
    }

    .legal-warning-title {
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.74rem;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .legal-warning-title span.icon {
      font-size: 1rem;
    }

    /* FLUJO DE USO + BOTÓN DESCARGA */
    .usage-flow {
      margin-top: 18px;
      padding-top: 14px;
      border-top: 1px solid #e5e7eb;
      font-size: 0.85rem;
      color: var(--color-text-muted);
    }

    .usage-title {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--color-text-main);
      margin-bottom: 6px;
    }

    .usage-list {
      list-style: decimal;
      padding-left: 18px;
      margin: 0 0 10px;
    }

    .usage-list li {
      margin-bottom: 4px;
      line-height: 1.5;
    }

    .cta-download {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
      padding: 9px 14px;
      border-radius: 999px;
      border: none;
      background: var(--color-primary);
      color: #f9fafb;
      font-size: 0.86rem;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.25);
      transition: transform 0.08s, box-shadow 0.08s, background 0.12s;
    }

    .cta-download span.icon {
      font-size: 1rem;
    }

    .cta-download:hover {
      background: #1d4ed8;
      box-shadow: 0 10px 26px rgba(37, 99, 235, 0.32);
    }

    .cta-download:active {
      transform: translateY(1px);
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.2);
    }

    footer {
      padding: 12px 24px 20px;
      text-align: center;
      font-size: 0.76rem;
      color: #9ca3af;
    }

    footer a {
      color: #bfdbfe;
      text-decoration: none;
    }

    footer a:hover { text-decoration: underline; }
  </style>
</head>
<body>
<div class="layout">
  <header>
    <div class="brand">
      <div class="brand-badge">VE</div>
      <div>
        VacEcPro
        <div style="font-size:0.7rem;font-weight:400;color:#9ca3af;">
          Herramienta profesional de esquemas de vacunación
        </div>
      </div>
    </div>
    <div class="env">Producción · PayPal Live</div>
  </header>

  <main>
    <div class="container">
      <!-- Columna izquierda -->
      <section class="hero" aria-labelledby="hero-title">
        <div class="hero-eyebrow">
          <span></span> Suscripciones seguras con PayPal
        </div>

        <h1 id="hero-title" class="hero-title">
          Activa tu acceso a <strong>VacEcPro</strong> en segundos.
        </h1>

        <p class="hero-subtitle">
          Gestiona esquemas de vacunación, recordatorios y seguimiento clínico
          con una herramienta pensada para profesionales de la salud.
          Elige el plan mensual o anual y realiza el pago con la seguridad de PayPal.
        </p>

        <ul class="hero-list">
          <li>Acceso completo a todas las funcionalidades de VacEcPro.</li>
          <li>Actualizaciones y mejoras continuas sin costo adicional.</li>
          <li>Renovación automática, con posibilidad de cancelar cuando quieras.</li>
          <li>Pagos procesados directamente por PayPal, sin almacenar datos de tarjeta en tus servidores.</li>
        </ul>

        <p class="hero-footnote">
          Tras completar la suscripción, tu cuenta será validada automáticamente
          contra PayPal y se habilitarán las funciones Pro en la aplicación.
        </p>
      </section>

      <!-- Columna derecha -->
      <section class="pricing-card" aria-label="Planes de suscripción">
        <header class="pricing-header">
          <div>
            <div class="pricing-title">Planes VacEcPro</div>
            <p class="pricing-description">
              Selecciona tu modalidad de pago. Ambos planes incluyen acceso completo a todas las funciones.
            </p>
          </div>
          <div class="pricing-badge">Suscripciones</div>
        </header>

        <!-- Correo -->
        <div class="user-info">
          <label for="emailInput">
            Correo electrónico (se utilizará como usuario en la app):
          </label>
          <input
            type="email"
            id="emailInput"
            placeholder="tu-correo@ejemplo.com"
            required
          />
        </div>

        <div class="tier-toggle" role="tablist" aria-label="Selector de periodo">
          <button id="btn-monthly" type="button" class="active" role="tab" aria-selected="true">
            Mensual
          </button>
          <button id="btn-yearly" type="button" role="tab" aria-selected="false">
            Anual <span>recomendado</span>
          </button>
        </div>

        <!-- Plan mensual -->
        <div id="price-monthly" class="price-panel">
          <div class="price-row">
            <div class="price-main">$3.99</div>
            <div class="price-period">/ mes · USD</div>
          </div>
          <div class="price-note">
            Facturación recurrente mensual gestionada por PayPal.
          </div>
          <p class="plan-details">
            <strong>Ideal</strong> para probar la herramienta en el día a día o para profesionales individuales.
          </p>

          <div class="paypal-section">
            <div class="paypal-label">Suscripción mensual vía PayPal</div>
            <div id="paypal-monthly" class="paypal-container"></div>
          </div>
        </div>

        <!-- Plan anual -->
        <div id="price-yearly" class="price-panel" style="display:none;">
          <div class="price-row">
            <div class="price-main">$29.99</div>
            <div class="price-period">/ año · USD</div>
          </div>
          <div class="price-note">
            Un solo pago anual. Equivale a menos de 2,50 USD al mes.
          </div>
          <p class="plan-details">
            <strong>Recomendado</strong> para equipos y uso continuo durante todo el año,
            con mejor relación costo–beneficio.
          </p>

          <div class="paypal-section">
            <div class="paypal-label">Suscripción anual vía PayPal</div>
            <div id="paypal-yearly" class="paypal-container"></div>
          </div>
        </div>

        <!-- Feedback -->
        <div id="feedback" aria-live="polite"></div>

        <!-- ADVERTENCIA LEGAL -->
        <div class="legal-warning">
          <div class="legal-warning-title">
            <span class="icon">⚖️</span>
            ADVERTENCIA LEGAL Y CONDICIONES DE USO
          </div>
          <p style="margin:0 0 4px;">
            VacEcPro es una herramienta de apoyo para la gestión y recordatorio de esquemas de vacunación.
            La información generada por la aplicación tiene carácter referencial y no sustituye en ningún caso
            el juicio clínico del profesional de la salud ni las normativas, calendarios oficiales
            o lineamientos vigentes emitidos por las autoridades sanitarias competentes.
          </p>
          <p style="margin:0 0 4px;">
            El usuario profesional es el único responsable de verificar dosis, esquemas, contraindicaciones
            y decisiones diagnósticas o terapéuticas, así como de contrastar la información con las guías
            y protocolos oficiales de su país o institución.
          </p>
          <p style="margin:0;">
            VacEcPro no está diseñada ni debe utilizarse para la atención de emergencias médicas.
            Ante cualquier situación urgente, el paciente debe ser derivado de inmediato a los servicios
            de emergencia correspondientes. Al utilizar esta aplicación, aceptas estos términos y reconoces
            que los desarrolladores no asumen responsabilidad por decisiones clínicas o administrativas
            basadas exclusivamente en la información mostrada por la plataforma.
          </p>
        </div>

        <!-- FLUJO DE USO + BOTÓN DESCARGA -->
        <div class="usage-flow">
          <div class="usage-title">¿Cómo funciona el flujo de uso?</div>
          <ol class="usage-list">
            <li>Elige el plan mensual o anual y realiza el pago de la suscripción con tu cuenta de PayPal.</li>
            <li>Una vez confirmada la suscripción, descarga la aplicación VacEcPro en tu dispositivo.</li>
            <li>Instala la app e inicia sesión utilizando el correo electrónico con el que realizaste la compra o el método de acceso que tu institución defina.</li>
            <li>El sistema validará tu suscripción activa y se habilitarán automáticamente las funciones Pro dentro de la aplicación.</li>
          </ol>

          <!-- REEMPLAZA href POR TU ENLACE REAL DE DESCARGA (APK o Play Store) -->
          <a class="cta-download"
             href="https://tu-enlace-de-descarga.com"
             target="_blank"
             rel="noopener noreferrer">
            <span class="icon">⬇️</span>
            Descargar app VacEcPro
          </a>
        </div>
      </section>
    </div>
  </main>

  <footer>
    VacEcPro · Integración PayPal Subscriptions (LIVE).  
    Para soporte técnico, contacta al administrador de la aplicación o revisa la
    documentación de <a href="https://developer.paypal.com/docs/subscriptions/" target="_blank" rel="noreferrer">PayPal Subscriptions</a>.
  </footer>
</div>

<!-- SDK PayPal LIVE -->
<script
  src="https://www.paypal.com/sdk/js?client-id=AT3pAQDw1XsPKoRVCCJ8d1Gb_Y7QwWXC9kk3nwQPzHJIXQizGZ0t9lMllTi4QRxtPvo6pI7lToIqFKjT&vault=true&intent=subscription&locale=es_EC&components=buttons">
</script>

<script>
  // URL de tu backend (en tu PC). Cambiar a https://tu-dominio.com/... en producción
  const BACKEND_URL = "https://vacecpro.onrender.com/api/paypal/validate-subscription";
  function showFeedback(type, message) {
    var container = document.getElementById('feedback');
    if (!container) return;

    if (!message) {
      container.innerHTML = '';
      return;
    }

    var isSuccess = type === 'success';
    var className = isSuccess ? 'alert alert-success' : 'alert alert-error';
    var icon = isSuccess ? '✅' : '⚠️';

    container.innerHTML =
      '<div class="' + className + '">' +
        '<div class="alert-icon">' + icon + '</div>' +
        '<div>' + message + '</div>' +
      '</div>';
  }

  function createSubscriptionButton(containerId, planId, label) {
    var container = document.getElementById(containerId);
    if (!container || !window.paypal) return;

    paypal.Buttons({
      style: {
        shape: 'pill',
        color: 'gold',
        layout: 'horizontal',
        label: 'subscribe',
        height: 48
      },

      // Crear suscripción en PayPal
      createSubscription: function (data, actions) {
        showFeedback(null, '');

        var emailInput = document.getElementById('emailInput');
        var email = emailInput ? emailInput.value.trim() : '';

        if (!email) {
          alert("Por favor ingresa tu correo electrónico antes de suscribirte.");
          return;
        }

        return actions.subscription.create({
          plan_id: planId
        });
      },

      // PayPal aprobó el pago
      onApprove: function (data, actions) {
        var emailInput = document.getElementById('emailInput');
        var email = emailInput ? emailInput.value.trim() : '';

        if (!email) {
          showFeedback('error', 'No se encontró el correo electrónico. Vuelve a intentarlo.');
          return;
        }

        // Usamos el correo como userId
        var userId = email;

        showFeedback('success',
          'Suscripción ' + label +
          ' creada en PayPal. Validando tu suscripción, por favor espera...'
        );

        // Llamada a tu backend Node
        fetch(BACKEND_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            subscriptionId: data.subscriptionID,
            userId: userId,
            email: email
          })
        })
          .then(function (res) { return res.json(); })
          .then(function (json) {
            if (!json.ok) {
              console.error("Respuesta del backend:", json);
              showFeedback(
                'error',
                'El pago se realizó en PayPal, pero hubo un problema al validar la suscripción. ' +
                'Si el cargo aparece en tu cuenta, contacta soporte con este ID: <strong>' +
                data.subscriptionID + '</strong>.'
              );
              return;
            }

            var status = json.subscriptionStatus || json.status || "desconocido";

            if (json.activeForApp) {
              showFeedback(
                'success',
                '✅ Suscripción ' + label + ' activa.<br>' +
                'ID de suscripción: <strong>' + data.subscriptionID + '</strong>.<br>' +
                'Ahora puedes descargar la app e iniciar sesión con <strong>' + email + '</strong>.'
              );
            } else {
              showFeedback(
                'error',
                'La suscripción se creó, pero PayPal la reporta con estado <strong>' +
                status +
                '</strong>. Revisa tu cuenta PayPal o inténtalo nuevamente.'
              );
            }
          })
          .catch(function (err) {
            console.error("Error llamando al backend:", err);
            showFeedback(
              'error',
              'Ocurrió un error de conexión al validar tu suscripción. Intenta nuevamente más tarde.'
            );
          });
      },

      onError: function (err) {
        console.error('PayPal error:', err);
        showFeedback(
          'error',
          'Ocurrió un problema al procesar el pago. ' +
          'Revisa la consola del navegador para más detalles o inténtalo de nuevo.'
        );
      }

    }).render('#' + containerId);
  }

  // Toggle mensual / anual
  (function setupToggle() {
    var btnMonthly = document.getElementById('btn-monthly');
    var btnYearly  = document.getElementById('btn-yearly');
    var panelMonthly = document.getElementById('price-monthly');
    var panelYearly  = document.getElementById('price-yearly');

    if (!btnMonthly || !btnYearly) return;

    btnMonthly.addEventListener('click', function () {
      btnMonthly.classList.add('active');
      btnMonthly.setAttribute('aria-selected', 'true');
      btnYearly.classList.remove('active');
      btnYearly.setAttribute('aria-selected', 'false');
      panelMonthly.style.display = '';
      panelYearly.style.display = 'none';
      showFeedback(null, '');
    });

    btnYearly.addEventListener('click', function () {
      btnYearly.classList.add('active');
      btnYearly.setAttribute('aria-selected', 'true');
      btnMonthly.classList.remove('active');
      btnMonthly.setAttribute('aria-selected', 'false');
      panelMonthly.style.display = 'none';
      panelYearly.style.display = '';
      showFeedback(null, '');
    });
  })();

  // Crear botones PayPal con tus IDs de plan
  if (window.paypal) {
    createSubscriptionButton(
      'paypal-monthly',
      'P-7WS92829J39649832NE3ABTY',  // plan mensual
      'mensual'
    );
    createSubscriptionButton(
      'paypal-yearly',
      'P-4B997107KS231694UNE3ADTY',  // plan anual
      'anual'
    );
  } else {
    console.error('PayPal SDK no se ha cargado correctamente.');
  }
</script>
</body>
</html>
